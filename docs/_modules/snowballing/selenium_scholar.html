

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>snowballing.selenium_scholar &mdash; snowballing 0.1.8 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="snowballing 0.1.8 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> snowballing
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/approaches.html">approaches.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/common_places.html">common_places.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/config.html">config.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/dbindex.html">dbindex.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/dbmanager.html">dbmanager.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/graph.html">graph.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/jupyter_utils.html">jupyter_utils.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/models.html">models.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/operations.html">operations.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/scholar.html">scholar.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/selenium_scholar.html">selenium_scholar.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/snowballing.html">snowballing.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../snowballing/utils.html">utils.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">snowballing</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>snowballing.selenium_scholar</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for snowballing.selenium_scholar</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module provides classes for querying Google Scholar using selenium and </span>
<span class="sd">parsing returned results. It currently *only* processes the first results</span>
<span class="sd">page. It is not a recursive crawler.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Based on scholar.py 2.10</span>
<span class="c1">#</span>
<span class="c1"># Don&#39;t complain about missing docstrings: pylint: disable-msg=C0111</span>
<span class="c1">#</span>
<span class="c1"># Copyright 2010--2014 Christian Kreibich. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Redistribution and use in source and binary forms, with or without</span>
<span class="c1"># modification, are permitted provided that the following conditions are</span>
<span class="c1"># met:</span>
<span class="c1">#</span>
<span class="c1">#    1. Redistributions of source code must retain the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#    2. Redistributions in binary form must reproduce the above</span>
<span class="c1">#       copyright notice, this list of conditions and the following</span>
<span class="c1">#       disclaimer in the documentation and/or other materials provided</span>
<span class="c1">#       with the distribution.</span>
<span class="c1">#</span>
<span class="c1"># THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED</span>
<span class="c1"># WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<span class="c1"># MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="c1"># DISCLAIMED. IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY DIRECT,</span>
<span class="c1"># INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<span class="c1"># (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<span class="c1"># SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<span class="c1"># HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>
<span class="c1"># STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING</span>
<span class="c1"># IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c1"># POSSIBILITY OF SUCH DAMAGE.</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">deque</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="k">import</span> <span class="n">uniform</span>

<span class="kn">from</span> <span class="nn">selenium</span> <span class="k">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.remote.errorhandler</span> <span class="k">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.keys</span> <span class="k">import</span> <span class="n">Keys</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="k">import</span> <span class="n">WebDriverWait</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="k">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="k">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="k">import</span> <span class="n">TimeoutException</span>

<span class="kn">from</span> <span class="nn">.scholar</span> <span class="k">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">encode</span><span class="p">,</span> <span class="n">unquote</span>
<span class="kn">from</span> <span class="nn">.scholar</span> <span class="k">import</span> <span class="n">Error</span><span class="p">,</span> <span class="n">FormatError</span><span class="p">,</span> <span class="n">QueryArgumentError</span><span class="p">,</span> <span class="n">ScholarConf</span>
<span class="kn">from</span> <span class="nn">.scholar</span> <span class="k">import</span> <span class="n">ScholarUtils</span><span class="p">,</span> <span class="n">ScholarArticle</span><span class="p">,</span> <span class="n">ScholarArticleParser120726</span>
<span class="kn">from</span> <span class="nn">.scholar</span> <span class="k">import</span> <span class="n">ScholarQuery</span><span class="p">,</span> <span class="n">BeautifulSoup</span>
<span class="kn">from</span> <span class="nn">.operations</span> <span class="k">import</span> <span class="n">work_by_varname</span>

<span class="n">ScholarConf</span><span class="o">.</span><span class="n">VERSION</span> <span class="o">=</span> <span class="s1">&#39;s1.00&#39;</span>
<span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_TIME</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_VARIATION</span> <span class="o">=</span> <span class="mf">0.5</span>


<div class="viewcode-block" id="get_scholar_url"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.get_scholar_url">[docs]</a><span class="k">def</span> <span class="nf">get_scholar_url</span><span class="p">(</span><span class="n">work</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets scholar url from work &quot;&quot;&quot;</span>
    <span class="n">scholar_url</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">urlparse</span><span class="p">(</span><span class="n">work</span><span class="o">.</span><span class="n">scholar</span><span class="p">))</span>
    <span class="n">scholar_url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;http&quot;</span>
    <span class="n">scholar_url</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;scholar.google.com&quot;</span>
    <span class="n">scholar_url</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">urlencode</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;cites&quot;</span><span class="p">:</span> <span class="n">parse_qs</span><span class="p">(</span><span class="n">scholar_url</span><span class="p">[</span><span class="mi">4</span><span class="p">])[</span><span class="s2">&quot;cites&quot;</span><span class="p">]},</span>
        <span class="n">doseq</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">urlunparse</span><span class="p">(</span><span class="n">scholar_url</span><span class="p">)</span></div>


<div class="viewcode-block" id="click"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.click">[docs]</a><span class="k">def</span> <span class="nf">click</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Clicks on selector &quot;&quot;&quot;</span>
    <span class="n">element</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
    <span class="n">element</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">element</span></div>


<div class="viewcode-block" id="URLQuery"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.URLQuery">[docs]</a><span class="k">class</span> <span class="nc">URLQuery</span><span class="p">(</span><span class="n">ScholarQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a Google Scholar query using a generic query</span>
<span class="sd">    We use it to navigate on the citations &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">ScholarQuery</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>

        
<div class="viewcode-block" id="URLQuery.get_url"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.URLQuery.get_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;&amp;&quot;</span> <span class="k">if</span> <span class="s2">&quot;?&quot;</span> <span class="ow">in</span> <span class="n">url</span> <span class="k">else</span> <span class="s2">&quot;?&quot;</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;start=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">url</span></div></div>


<div class="viewcode-block" id="Result"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.Result">[docs]</a><span class="k">class</span> <span class="nc">Result</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Represents a result with articles &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">html</span> <span class="o">=</span> <span class="n">html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">next_page</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_page</span> <span class="o">=</span> <span class="kc">None</span>
        
<div class="viewcode-block" id="Result.set_navigation"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.Result.set_navigation">[docs]</a>    <span class="k">def</span> <span class="nf">set_navigation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_link_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">URLQuery</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;href&quot;</span><span class="p">)))</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
            <span class="k">pass</span></div></div>


<div class="viewcode-block" id="AddArticleTask"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.AddArticleTask">[docs]</a><span class="k">class</span> <span class="nc">AddArticleTask</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Task that adds an article to the result &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">article</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">article</span> <span class="o">=</span> <span class="n">article</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        
<div class="viewcode-block" id="AddArticleTask.get_citation_data"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.AddArticleTask.get_citation_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_citation_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querier</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given an article, retrieves citation link. Note, this requires that</span>
<span class="sd">        you adjusted the settings to tell Google Scholar to actually</span>
<span class="sd">        provide this information, *prior* to retrieving the article.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;url_citation&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">citation_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;retrieving citation export data: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="p">[</span><span class="s2">&quot;url_citation&quot;</span><span class="p">]</span>
        <span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">querier</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="p">[</span><span class="s1">&#39;url_citation&#39;</span><span class="p">],</span>
                                    <span class="n">log_msg</span><span class="o">=</span><span class="s1">&#39;citation data response&#39;</span><span class="p">,</span>
                                    <span class="n">err_msg</span><span class="o">=</span><span class="s1">&#39;requesting citation data failed&#39;</span><span class="p">,</span>
                                    <span class="n">condition</span><span class="o">=</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">TAG_NAME</span><span class="p">,</span> <span class="s1">&#39;pre&#39;</span><span class="p">))</span>
        <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">querier</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Connection error&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="o">.</span><span class="n">set_citation_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>
        
<div class="viewcode-block" id="AddArticleTask.apply"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.AddArticleTask.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querier</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">articles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="s1">&#39;num_results&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_citation_data</span><span class="p">(</span><span class="n">querier</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">article</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ParseTask"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ParseTask">[docs]</a><span class="k">class</span> <span class="nc">ParseTask</span><span class="p">(</span><span class="n">ScholarArticleParser120726</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Task that parsers articles &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="n">ScholarArticleParser120726</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">querier</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="ParseTask.handle_num_results"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ParseTask.handle_num_results">[docs]</a>    <span class="k">def</span> <span class="nf">handle_num_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_results</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">query</span><span class="p">[</span><span class="s1">&#39;num_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_results</span></div>

<div class="viewcode-block" id="ParseTask.handle_article"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ParseTask.handle_article">[docs]</a>    <span class="k">def</span> <span class="nf">handle_article</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">art</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">art</span><span class="p">)</span></div>

<div class="viewcode-block" id="ParseTask.apply"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ParseTask.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querier</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">querier</span> <span class="o">=</span> <span class="n">querier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">html</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">art</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">articles</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">querier</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">AddArticleTask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">art</span><span class="p">))</span></div></div>



<div class="viewcode-block" id="QueryTask"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.QueryTask">[docs]</a><span class="k">class</span> <span class="nc">QueryTask</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Task that queries the scholar &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        
<div class="viewcode-block" id="QueryTask.apply"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.QueryTask.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querier</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="n">querier</span><span class="o">.</span><span class="n">get_response</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">get_url</span><span class="p">(),</span>
                                    <span class="n">log_msg</span><span class="o">=</span><span class="s1">&#39;dump of query response HTML&#39;</span><span class="p">,</span>
                                    <span class="n">err_msg</span><span class="o">=</span><span class="s1">&#39;results retrieval failed&#39;</span><span class="p">,</span>
                                    <span class="n">condition</span><span class="o">=</span><span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;gs_ab&quot;</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">html</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">querier</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Error</span><span class="p">(</span><span class="s2">&quot;Connection error&quot;</span><span class="p">)</span>
            
        <span class="n">querier</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">Result</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="n">querier</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">set_navigation</span><span class="p">(</span><span class="n">querier</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;next_page&quot;</span><span class="p">,</span> <span class="s2">&quot;Next&quot;</span><span class="p">)</span>
        <span class="n">querier</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">set_navigation</span><span class="p">(</span><span class="n">querier</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;prev_page&quot;</span><span class="p">,</span> <span class="s2">&quot;Previous&quot;</span><span class="p">)</span>
        
        <span class="n">querier</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">appendleft</span><span class="p">(</span><span class="n">ParseTask</span><span class="p">(</span><span class="n">querier</span><span class="o">.</span><span class="n">result</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="SearchScholarQuery"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery">[docs]</a><span class="k">class</span> <span class="nc">SearchScholarQuery</span><span class="p">(</span><span class="n">ScholarQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This version represents the search query parameters the user can</span>
<span class="sd">    configure on the Scholar website, in the advanced search options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">SCHOLAR_QUERY_URL</span> <span class="o">=</span> <span class="n">ScholarConf</span><span class="o">.</span><span class="n">SCHOLAR_SITE</span> <span class="o">+</span> <span class="s1">&#39;/scholar?&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ScholarQuery</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_attribute_type</span><span class="p">(</span><span class="s1">&#39;num_results&#39;</span><span class="p">,</span> <span class="s1">&#39;Results&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># The default search behavior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words_some</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># At least one of those words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words_none</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># None of these words</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_title</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># If True, search in title only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_patents</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_citations</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="SearchScholarQuery.set_words"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_words">[docs]</a>    <span class="k">def</span> <span class="nf">set_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets words that *all* must be found in the result.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words</span> <span class="o">=</span> <span class="n">words</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_words_some"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_words_some">[docs]</a>    <span class="k">def</span> <span class="nf">set_words_some</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets words of which *at least one* must be found in result.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words_some</span> <span class="o">=</span> <span class="n">words</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_words_none"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_words_none">[docs]</a>    <span class="k">def</span> <span class="nf">set_words_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">words</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets words of which *none* must be found in the result.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">words_none</span> <span class="o">=</span> <span class="n">words</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_phrase"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_phrase">[docs]</a>    <span class="k">def</span> <span class="nf">set_phrase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">phrase</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets phrase that must be found in the result exactly.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span> <span class="o">=</span> <span class="n">phrase</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_scope"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_scope">[docs]</a>    <span class="k">def</span> <span class="nf">set_scope</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title_only</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets Boolean indicating whether to search entire article or title</span>
<span class="sd">        only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scope_title</span> <span class="o">=</span> <span class="n">title_only</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_author"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_author">[docs]</a>    <span class="k">def</span> <span class="nf">set_author</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">author</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets names that must be on the result&#39;s author list.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">author</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_pub"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_pub">[docs]</a>    <span class="k">def</span> <span class="nf">set_pub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pub</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the publication in which the result must be found.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="o">=</span> <span class="n">pub</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_timeframe"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_timeframe">[docs]</a>    <span class="k">def</span> <span class="nf">set_timeframe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets timeframe (in years as integer) in which result must have</span>
<span class="sd">        appeared. It&#39;s fine to specify just start or end, or both.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">ensure_int</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">end</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">ensure_int</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span> <span class="o">=</span> <span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">]</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_include_citations"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_include_citations">[docs]</a>    <span class="k">def</span> <span class="nf">set_include_citations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yesorno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_citations</span> <span class="o">=</span> <span class="n">yesorno</span></div>

<div class="viewcode-block" id="SearchScholarQuery.set_include_patents"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.set_include_patents">[docs]</a>    <span class="k">def</span> <span class="nf">set_include_patents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">yesorno</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include_patents</span> <span class="o">=</span> <span class="n">yesorno</span></div>

<div class="viewcode-block" id="SearchScholarQuery.get_url"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SearchScholarQuery.get_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">words_some</span> <span class="ow">is</span> <span class="kc">None</span> \
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">words_none</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span> <span class="ow">is</span> <span class="kc">None</span> \
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="ow">is</span> <span class="kc">None</span> \
           <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">QueryArgumentError</span><span class="p">(</span><span class="s1">&#39;search query needs more parameters&#39;</span><span class="p">)</span>

        <span class="c1"># If we have some-words or none-words lists, we need to</span>
        <span class="c1"># process them so GS understands them. For simple</span>
        <span class="c1"># space-separeted word lists, there&#39;s nothing to do. For lists</span>
        <span class="c1"># of phrases we have to ensure quotations around the phrases,</span>
        <span class="c1"># separating them by whitespace.</span>
        <span class="n">words_some</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">words_none</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">words_some</span><span class="p">:</span>
            <span class="n">words_some</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parenthesize_phrases</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words_some</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">words_none</span><span class="p">:</span>
            <span class="n">words_none</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parenthesize_phrases</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">words_none</span><span class="p">)</span>

        <span class="n">urlargs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;as_q&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_epq&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phrase</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_oq&quot;</span><span class="p">,</span> <span class="n">words_some</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_eq&quot;</span><span class="p">,</span> <span class="n">words_none</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_occt&quot;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scope_title</span> <span class="k">else</span> <span class="s1">&#39;any&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_sauthors&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">author</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_publication&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_ylo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_yhi&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeframe</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_sdt&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_patents</span> <span class="k">else</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%2C5&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;as_vis&quot;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_citations</span> <span class="k">else</span> <span class="s1">&#39;1&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        
        <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">quote</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">urlargs</span>
         <span class="c1">#   if value</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">SCHOLAR_QUERY_URL</span> <span class="o">+</span> <span class="n">args</span> <span class="o">+</span> <span class="s2">&quot;&amp;btnG=&amp;hl=en&quot;</span></div></div>


<div class="viewcode-block" id="wait_for"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.wait_for">[docs]</a><span class="k">def</span> <span class="nf">wait_for</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Wait for an element appear during :delay seconds &quot;&quot;&quot;</span>
    <span class="n">WebDriverWait</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">delay</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span><span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_captcha"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.check_captcha">[docs]</a><span class="k">def</span> <span class="nf">check_captcha</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">condition</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Check if it expects a captcha &quot;&quot;&quot;</span>
    <span class="n">captcha</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#captcha&quot;</span><span class="p">)</span>
    <span class="n">captcha</span> <span class="o">+=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#gs_captcha_f&quot;</span><span class="p">)</span>
    <span class="n">captcha</span> <span class="o">+=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#g-recaptcha&quot;</span><span class="p">)</span>
    <span class="n">captcha</span> <span class="o">+=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#recaptcha&quot;</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">captcha</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Ops. It requires a captcha!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;If you filled in the browser, type &#39;&lt;ok&gt;&#39; here.&quot;</span><span class="p">)</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Captcha: &quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inp</span> <span class="o">==</span> <span class="s2">&quot;&lt;ok&gt;&quot;</span><span class="p">:</span>
            <span class="k">break</span> 
        <span class="n">captcha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="n">captcha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">send_keys</span><span class="p">(</span><span class="n">Keys</span><span class="o">.</span><span class="n">RETURN</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">condition</span><span class="p">:</span>
                <span class="n">wait_for</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="n">TimeoutException</span><span class="p">:</span>
            <span class="n">captcha</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">find_elements_by_css_selector</span><span class="p">(</span><span class="s2">&quot;#captcha&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ScholarSettingsTask"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ScholarSettingsTask">[docs]</a><span class="k">class</span> <span class="nc">ScholarSettingsTask</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class lets you adjust the Scholar settings for your</span>
<span class="sd">    session.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CITFORM_NONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">CITFORM_REFWORKS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">CITFORM_REFMAN</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">CITFORM_ENDNOTE</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">CITFORM_BIBTEX</span> <span class="o">=</span> <span class="mi">4</span>
    
    <span class="n">COLLECTIONS_ARTICLES_ONLY</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">COLLECTIONS_ARTICLES_AND_PATENTS</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">COLLECTIONS_CASE_LAW</span> <span class="o">=</span> <span class="mi">2</span>
    
    <span class="n">SETTINGS_URL</span> <span class="o">=</span> <span class="p">(</span>
    	<span class="n">ScholarConf</span><span class="o">.</span><span class="n">SCHOLAR_SITE</span> <span class="o">+</span> 
    	<span class="s1">&#39;/scholar_settings?hl=en&amp;as_sdt=0,5&amp;sciodt=0,5&#39;</span>
    <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pages</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">citform</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">new_window</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">collections</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_configured</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">citform</span> <span class="o">=</span> <span class="n">citform</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">per_page_results</span> <span class="o">=</span> <span class="n">pages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_window</span> <span class="o">=</span> <span class="n">new_window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">citform</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_citform</span>
        
    <span class="nd">@citform</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">citform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">ensure_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormatError</span><span class="p">(</span><span class="s2">&quot;Error: &#39;citform&#39; must be between 0 and 4&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_citform</span> <span class="o">=</span> <span class="n">value</span>
            
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">per_page_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_per_page_results</span>
        
    <span class="nd">@per_page_results</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">per_page_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">ensure_int</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;page results must be integer&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">}:</span>
            <span class="k">raise</span> <span class="n">FormatError</span><span class="p">(</span><span class="s2">&quot;Error: &#39;pages&#39; must be either 10 or 20&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_per_page_results</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">new_window</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_window</span>
        
    <span class="nd">@new_window</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">new_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_window</span> <span class="o">=</span> <span class="n">value</span>
        
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">collections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span>
        
    <span class="nd">@collections</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">ensure_int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FormatError</span><span class="p">(</span><span class="s2">&quot;Error: &#39;collections&#39; must be between 0 and 2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_configured</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collections</span> <span class="o">=</span> <span class="n">value</span>
    
<div class="viewcode-block" id="ScholarSettingsTask.apply"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.ScholarSettingsTask.apply">[docs]</a>    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">querier</span><span class="p">):</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">querier</span><span class="o">.</span><span class="n">driver</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_configured</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ScholarSettingsTask</span><span class="o">.</span><span class="n">SETTINGS_URL</span><span class="p">)</span>
        <span class="n">check_captcha</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="p">(</span><span class="n">By</span><span class="o">.</span><span class="n">ID</span><span class="p">,</span> <span class="s2">&quot;gs_num-bd&quot;</span><span class="p">))</span>
        

        <span class="n">results_per_page</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#gs_num-bd&quot;</span><span class="p">)</span>
        <span class="n">twenty_results</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span>
        	<span class="n">results_per_page</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> 
        	<span class="s1">&#39;li[data-v=&quot;</span><span class="si">{}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">per_page_results</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">citform</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cittype</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#gs_scisf-bd&quot;</span><span class="p">)</span>
            <span class="n">bibtex</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span>
            	<span class="n">cittype</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;li[data-v=&quot;</span><span class="si">{}</span><span class="s1">&quot;]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">citform</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dont_show</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#scis0&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_window</span><span class="p">:</span>
            <span class="n">new_window</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#gs_nw&quot;</span><span class="p">)</span>
            
        <span class="n">case_laws</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#as_sdt2&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">articles</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#as_sdt1&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collections</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">patents</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s2">&quot;#as_sdtp&quot;</span><span class="p">)</span>
            
        <span class="n">save_button</span> <span class="o">=</span> <span class="n">click</span><span class="p">(</span><span class="n">driver</span><span class="p">,</span> <span class="s1">&#39;.gs_btn_act[name=&quot;save&quot;]&#39;</span><span class="p">)</span>
        <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;settings applied&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="SeleniumScholarQuerier"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SeleniumScholarQuerier">[docs]</a><span class="k">class</span> <span class="nc">SeleniumScholarQuerier</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ScholarQuerier instances can conduct a search on Google Scholar</span>
<span class="sd">    with subsequent parsing of the resulting HTML content.  The</span>
<span class="sd">    articles found are collected in the articles member, a list of</span>
<span class="sd">    ScholarArticle instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">driver</span> <span class="ow">or</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_TIME</span> <span class="o">-</span> <span class="mi">1</span>
        
<div class="viewcode-block" id="SeleniumScholarQuerier.continue_tasks"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SeleniumScholarQuerier.continue_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">continue_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="p">:</span>
            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">task</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">articles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">articles</span></div>
        
<div class="viewcode-block" id="SeleniumScholarQuerier.apply_settings"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SeleniumScholarQuerier.apply_settings">[docs]</a>    <span class="k">def</span> <span class="nf">apply_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Applies settings&quot;&quot;&quot;</span>
        <span class="n">settings</span> <span class="o">=</span> <span class="n">ScholarSettingsTask</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continue_tasks</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>
        
<div class="viewcode-block" id="SeleniumScholarQuerier.send_query"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SeleniumScholarQuerier.send_query">[docs]</a>    <span class="k">def</span> <span class="nf">send_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initiates a search query (a ScholarQuery instance)&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">QueryTask</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continue_tasks</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="SeleniumScholarQuerier.get_response"><a class="viewcode-back" href="../../snowballing/selenium_scholar.html#snowballing.selenium_scholar.SeleniumScholarQuerier.get_response">[docs]</a>    <span class="k">def</span> <span class="nf">get_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">log_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">err_msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">condition</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method, sends HTTP request and returns response payload.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">log_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">log_msg</span> <span class="o">=</span> <span class="s1">&#39;HTTP response data follow&#39;</span>
        <span class="k">if</span> <span class="n">err_msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s1">&#39;request failed&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;requesting </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">unquote</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

            <span class="n">current</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">while</span> <span class="n">current</span> <span class="o">-</span> <span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_TIME</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span><span class="p">:</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">-</span> <span class="n">current</span> <span class="o">+</span> <span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_TIME</span><span class="p">)</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_request</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">+</span> <span class="n">uniform</span><span class="p">(</span>
                <span class="o">-</span><span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_VARIATION</span><span class="p">,</span> <span class="n">ScholarConf</span><span class="o">.</span><span class="n">DELTA_VARIATION</span>
            <span class="p">)</span>
            <span class="n">check_captcha</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        
            <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span>

            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="n">log_msg</span><span class="p">)</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&gt;&gt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">68</span><span class="p">)</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;url: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">current_url</span><span class="p">)</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;data:</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">html</span><span class="p">)</span> <span class="c1"># For Python 3</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&lt;&lt;&lt;&#39;</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">68</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">html</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">ScholarUtils</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">err_msg</span> <span class="o">+</span> <span class="s1">&#39;: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span></div></div>
</pre></div>

           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Joao Felipe Pimentel.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.8',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>